<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		#canvas {
			border: 1px dashed black
		}
	</style>
</head>
<body>

<canvas id='canvas' style="display: block" height="500" width="500">
Ваш браузер не поддерживает canvas
</canvas>



</body>
<script type="text/javascript">
	let NOTsort = [
		// { width : 80, height : 80}, 
		// { width : 40, height : 60}, 
		// { width : 40, height : 60}, 
		// { width : 40, height : 20}, 
		// { width : 40, height : 15}, 
		// { width : 40, height : 80}, 

		// { width : 10, height : 80}, 
		// { width : 40, height : 70}, 


		// { width : 25, height : 90}, 
		// { width : 25, height : 90}, 
		// { width : 25, height : 30}, 
		// { width : 35, height : 35}, 
		// { width : 45, height : 40}, 


		{ width : 45, height : 30}, 
		{ width : 45, height : 55}, 
		{ width : 40, height : 65}, 
		// { width : 40, height : 20}, 
		// { width : 40, height : 20}, 
		// { width : 25, height : 90}, 
		// { width : 40, height : 20}, 
	]

	const qWSort = (arr) => {
		if (arr.length < 2) {
			return arr
		} else {
			let pivot = arr[Math.floor(Math.random() * arr.length)] // {width: 30}
			let less = arr.filter(value => value.width > pivot.width) // Все что больше
			let eq = arr.filter(key => key.width == pivot.width) // Равны
			let greater = arr.filter(key => key.width < pivot.width) // Все что меньше
			return [...qWSort(less), ...eq ,...qWSort(greater)]
		}
	}


	const qHSort = (arr) => {
		if (arr.length < 2) {
			return arr
		} else {
			let pivot = arr[Math.floor(Math.random() * arr.length)] // {height: 30}
			let less = arr.filter(value => value.height > pivot.height) // Все что ольше
			let eq = arr.filter(key => key.height == pivot.height) 
			let greater = arr.filter(key => key.height < pivot.height) // Все что меньше
			return [...qHSort(less), ...eq ,...qHSort(greater)]
		}
	}

	

	// Отсорнтирован 
	let sort = qHSort(qWSort(NOTsort))


	var canv = document.getElementById('canvas'),
	ctx =  canv.getContext('2d');
	ctx.strokeStyle = 'Black' // Цвет контура, без заливки
	ctx.lineWidth = 2; // Толщина линии

	let newSort = []


	//Пробуй вставить сверзу, если не получается пробуй снизу. При этомне должно быть координат

	sort.map((key,index) => {
		if (newSort.length < 1) {
			newSort = [{...key, x:0, y:0, corX: {x:key.width, y:0}, corY: {x:0, y:key.height}}]
		} else {
				for (i = 0; i < newSort.length; i++) {
					if (!newSort.some(item => 
							false
							// item.x > newSort[i].x &
							// item.y > newSort[i].y &
							// item.x + item.width < newSort[i].x + newSort[i].width &
							// item.y + item.height < newSort[i].y + newSort[i].height 

						 )) {
								newSort = [...newSort, {...key, 
									x: newSort[i].corX.x, 
									y: newSort[i].corX.y, 
									corX: {x: newSort[i].y, y: newSort[i].x + key.width}, 
									corY: {x: newSort[i].y + key.height, y: newSort[i].y}}
								]
								break

				}


					// if (!newSort.some(item => item.y == newSort[i].y + newSort[i].height && item.x == newSort[i].x)) {
					// 	if (!newSort.some(item => item.y == newSort[i].y + newSort[i].height && item.x == newSort[i].x)) {
					// 		newSort = [...newSort, 
					// 				{...key, 
					// 					x: newSort[i].x,
					// 					y: newSort[i].y + newSort[i].height}]
					// 					break
					// 	} else {
					// 		newSort = [...newSort, 
					// 				{...key, 
					// 					x: newSort[i].x,
					// 					y: newSort[i].y + newSort[i].height}]
					// 					break
					// 	}
					// } else {
					// 	newSort = [...newSort, 
					// 				{...key, 
					// 					x: newSort[i].x + newSort[i].width,
					// 					y: newSort[i].y}]
					// 	break
					// }




					// if (newSort[i].y + newSort[i].height + key.height <= newSort[0].height && !newSort.some(item => item.y == newSort[i].y + newSort[i].height && item.x == newSort[i].x )) {
					// 	console.log(index)
					// 	console.log('шт1')
					// 		newSort = [...newSort, 
					// 				{...key, 
					// 					x: newSort[i].x,
					// 					y: newSort[i].y + newSort[i].height}]
					// 	break

						
					// } else if (!newSort.some(item => item.y == newSort[i].y && item.x == newSort[i].x + newSort[i].width)
					//  ) {

					// 	newSort = [...newSort, 
					// 				{...key, 
					// 					x: newSort[i].x + newSort[i].width,
					// 					y: newSort[i].y}]
					// 	break
					// } 


					// switch(true) {
					//   case 	newSort[i].y + newSort[i].height + key.height <= newSort[0].height 
					// 		&& 
					// 		!newSort.some(item => item.y == newSort[i].y + newSort[i].height 
					// 			&& 
					// 			item.x == newSort[i].x):  
					//     newSort = [...newSort, 
					// 					{...key, 
					// 						x: newSort[i].x,
					// 						y: newSort[i].y + newSort[i].height}]
					//     break

					//   case 	newSort[i].y + newSort[i].height + key.height <= newSort[0].height: 
					//     newSort = [...newSort, 
					// 					{...key, 
					// 						x: newSort[i].x,
					// 						y: newSort[i].y + newSort[i].height}]
					//     break
					//   case 	!newSort.some(item => item.y == newSort[i].y 
					// 	  	&& 
					// 	  	item.x == newSort[i].x + newSort[i].width): 
					//     	newSort = [...newSort, 
					// 					{...key, 
					// 						x: newSort[i].x + newSort[i].width,
					// 						y: newSort[i].y}]
					//     break

					//   default:
					//     return
					//     break
					// }

				}
		}
		
	}) 

	console.log(newSort)
	newSort.map((key,index)=>{
		ctx.strokeRect(key.x, key.y ,key.width ,key.height)
		ctx.font = "12px Verdana";
        ctx.fillText(index, key.x+5, key.y+15);
	})
	


</script>
</html>